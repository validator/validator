default namespace = "http://www.thaiopensource.com/validate/picl"

start = element constraints { inherited, constraints }

constraints = (key|ref|scope|union)+

scope = element scope { select, inherited, constraints }

key =
  element key {
    attribute allowDuplicates { xsd:boolean }?,
    attribute name { xsd:NCName }?, # names must be unique in the scope
    select,
    inherited,
    element field {
      attribute type { xsd:NCName }?,
      select,
      inherited,
      convert?,
      dflt?
    }*,
    constraints?
  }

union =
  element union {
    inherited,
    attribute name { xsd:NCName }?, # names must be unique in the scope
    key+
  }

ref =
  element ref {
    select,
    element not { select }*,
    refBody
  }

refBody =
    attribute name { xsd:NCName }, # refers to key or union in same scope
    inherited,
    element field { select, inherited, convert?, dflt? }+,
    element ref { refBody }?


select = attribute select { path }
convert = attribute convert { "detag" | "split" }

dflt =
  attribute default { "null" | "skip" }
  | attribute defaultValue { text }

path = xsd:string

inherited =
  attribute ns { xsd:anyURI }?,
  attribute datatypeLibrary { xsd:anyURI }?
